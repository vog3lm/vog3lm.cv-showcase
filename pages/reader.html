<!DOCTYPE html>
<html>
<head>
	<meta charset='utf-8'/>
	<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<title>vog3lm.cv.reader</title>
	<link rel="manifest" href="/manifest.json">
	
    <link rel="stylesheet" href="css/font.awesome.min.css">
    <link rel="stylesheet" href="css/font.geometry.css">
    <link rel="stylesheet" href="css/design.geometry.css">

	<link rel="shortcut icon" href="images/favicon.coyote.poly_white.b.png" type="image/x-icon" />
	<link rel="icon" 		  href="images/favicon.coyote.poly_white.b.png" type="image/x-icon" />

	<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase-auth.js"></script>
	<script src="https://www.gstatic.com/firebasejs/4.9.1/firebase-storage.js"></script>

	<script type="text/javascript" src="js/jq.min.js"></script>
	<script type="text/javascript" src="js/backend.js"></script>
	<script type="text/javascript" src="js/animate.dots.js"></script>
	<script type="text/javascript" src="js/animate.dotNet.js"></script>
	<script type="text/javascript">

		var animations = {}
		var dispatcher = null

		function ReaderPresenterLinker(){
			var presenter = {'content':ReaderContentPresenter
							,'footer':ReaderFooterPresenter};

			this.link = (id) => {if(presenter.hasOwnProperty(id)){new presenter[id]().show();}}
		}
		function ReaderContentPresenter(){
			var head = ''		
			+ '<div class="head">'
				+ '<h1>[TITLE]</h1>'
				+ '<h5>[TIME]</h5>'
				+ '<nav>[LINK]</nav>'
				+ '<img src="[LOGO]">'
			+ '</div>';
			var link = '<a href="#" class="fa fa-1-5x [ICON]" call="[CALL]"></a>';
			var rate = '<div class="rate">[RATE]</div>';
			this.show = {
				'replace':(views) => {
					var home = $('header section#content');
					if(home.has('div.dummy')){
						home.find('div.dummy').remove();
					}

					var cols = views.cols;
					var idxTitle = cols.indexOf('title');
					var idxTime = cols.indexOf('time');
					var idxRate = cols.indexOf('rating');
					var idxLogo = cols.indexOf('logo');
					var idxLinks = cols.indexOf('links');
					var html = ''
					for(var i=0; i<views.recs.length; i++){
						var tl = '';
						var links = views.recs[i][idxLinks]
						for(var key in links){
							tl += link.replace('[ICON]',key).replace('[ICON]',links[key]);
						}
						html += head.replace('[TITLE]',views.recs[i][idxTitle])
									.replace('[TIME]',views.recs[i][idxTime])
									.replace('[LOGO]',views.recs[i][idxLogo])
									.replace('[LINK]',tl)
						html += rate.replace('[RATE]',views.recs[i][idxRate])
					}
					home.children('div').each(function(){
						var element = $(this).remove();
					});
					home.find('nav#doc-navigation').after($(html));
				}
			}
		}
		function ReaderFooterPresenter(){
			this.show = {
				'left':(views) => {console.log('replace footer left',views)}
			   ,'angel':(views) => {console.log('remove footer angel',views)}
			   ,'right':(views) => {console.log('remove footer right',views)}
			}
		}


		var animations= [{'lineColor':'#777','lineWidth':'1px','paneParent':'zone','paneId':'one'}
				  		,{'lineColor':'#777','lineWidth':'1px','paneParent':'zone','paneId':'two'}];
		function ReaderEventListener(){
			var style = new St1l34p1Operator().create();
			var authenticate = new F1rebas3Auth4p1Operator(firebase).create();
			var storage = new F1rebas3Storage4p1Operator(firebase).create();
			var scroller = new Scro114p1Operator().decorate({'node':'section#content'}).create();
			var mvp = new Mvp4p1Operator().create();
			var content = new ReaderContentPresenter();

			var one = new DotNetHolder().operator.decorate(animations[0]).create().start();
			var two = new DotNetHolder().operator.decorate(animations[1]).create().start();
			var events = {
				'help-toggle':(data) => {
					var popup = $('popup');
					popup.find('span#message').html('');
					popup.css({'left':(window.innerWidth-popup.outerWidth())/2,'top':(window.innerHeight-popup.outerHeight())/2});
					popup.toggleClass('hide');
				}
				,'token-toggle':(data) => {
					var popup = $('popup');
					popup.find('span#message').html(authenticate.getToken());
					popup.css({'left':(window.innerWidth-popup.outerWidth())/2,'top':(window.innerHeight-popup.outerHeight())/2});
					popup.toggleClass('hide');
				}
				,'cfg-toggle':(data) => {
					$('header nav#cfg-navigation').toggleClass('hide');
					$('header nav#doc-controls').toggleClass('hide');
				}
				,'login-show':(data) => {
					var tag = $('user')
					tag.find('form').removeClass('hide');
					tag.find('a.fa-hashtag').attr('call','login-hide');
				}
				,'login-hide':(data) => {
					var tag = $('user')
					tag.find('form').addClass('hide');
					tag.find('a.fa-hashtag').attr('call','login-show');
				}
				,'login-validate':(data) => {
					$('body').trigger('loading-start',{'call':'loading-start','id':'login-validate'});
					$('body').trigger('log-in',[{'mail':$('input#mail').val(),'pass':$('input#pass').val(),'call':'log-in','id':'login-validate'}]);
				}
				,'logged-in':(data) => {
					var tag = $('user')
					tag.find('input#mail').val('');
					tag.find('input#pass').val('');
					tag.find('card').removeClass('hide')
					tag.find('a.fa-hashtag').attr('call','log-out');
					tag.find('id').html(data.mail);
					$('body').trigger('loading-stop',{'call':'loading-stop','id':'logged-in'});
				}
				,'log-out':(data) => {
					$('body').trigger('loading-start',{'call':'loading-starts','id':'logged-out'});
				}
				,'logged-out':(data) => {
					var tag = $('user')
					tag.find('card').addClass('hide')
					tag.find('input#mail').val('');
					tag.find('input#pass').val('');

			    	tag.find('user span#mail').html('');
			    	//	$('user a.fa-user').attr('call','log-in');
			    	$('body').trigger('loading-stop',{'call':'loading-stop','id':'logged-out'});
			    }
				,'got-token':(data) => {
					var url = window.location.href;
					if(window.history.pushState){
					   history.pushState(null,null,'/reader');
					}
					var query = url.substring(url.indexOf('?')+1,url.length).split('&');
					var args = {}
					for(var i=0; i<query.length; i++){
						var split = query[i].split('=');
						args[split[0]]=split[1];
					}
					if(args.hasOwnProperty('q')){
						$('body').trigger('call-mvp',{'call':'call-mvp','id':'uiLT6kFBG','q':'uiLT6kFBG'});
					} else if(window.mvp){
						$('body').trigger('call-mvp',{'call':'call-mvp','id':'uiLT6kFBG','q':'uiLT6kFBG'});
						window.mvp = null;
					}
				}
				,'got-mvp':(data) => {
					content.show.replace(data.view);
					scroller.refresh();
				}
				,'animation-click':(data) => {console.log('animation-click',data)}

				,'animation-pause':(data) => {
					$('nav a.fa-pause').each(function(){
						var element = $(this)
						element.attr('call','animation-play')
						element.removeClass('fa-pause')
						element.addClass('fa-play')
					})
					jQuery.each(animations,(key,value) => {
					  	value.pause()
					});
				}
				,'animation-play':(data) => {
					$('nav a.fa-play').each(function(){
						var element = $(this)
						element.attr('call','animation-pause')
						element.removeClass('fa-play')
						element.addClass('fa-pause')
					})
					jQuery.each(animations,(key,value) => {
					  	value.pause()
					});
				}
				,'animation-colors':(data) => {
					var colors = ['#fb1','#67f','#b0f','#2F2','#6be','#e5f','#ff1','#777']
					jQuery.each(animations,(key,value) => {
					  	value.decorate({'lineColor':colors[Math.floor(Math.random()*(colors.length-1))]})
					});
				}
				,'scroll-up':() => {
					scroller.delta(-400);
				}
				,'scroll-down':() => {
					scroller.delta(400);
				}

				,'call-mvp-test':() => {
					$('body').trigger('call-mvp',{'call':'call-mvp','id':'uiLT6kFBG','q':'uiLT6kFBG'});
				}
			}
			this.getEvents = function(){
				return {'events':Object.keys(events),'issues':Object.values(events)}
			}
		}

		var app = null;
		$(document).ready(function(){
			// Initialize Firebase
			var config = {
			    apiKey: "AIzaSyDmXSkwOam-aQ37z8-3d5aH-X257lIVS34",
			    authDomain: "vog3lm-0x1.firebaseapp.com",
			    projectId: "vog3lm-0x1",
			    storageBucket: "vog3lm-0x1.appspot.com",
			};
			firebase.initializeApp(config);
		});
		$(window).load(function() {
			dispatcher = new V13wEv3ntD1spatch3r(new ReaderEventListener().getEvents())
			dispatcher.onRegister()
			dispatcher.onUnleash()
		});
	</script>
	<style type="text/css">
		header canvas {
			position: absolute;
		}
		canvas#one{
			transform:rotateY(30deg) scaleX(1.15);
		}
		canvas#two{
			transform:rotateY(-20deg) scaleX(1.15);
		}


		/* font color*/
		header section#content{
			color:darkgray;
			font-size:1.5em;
			background:rgba(27,27,27,0.9)
		}
		header section#content{
			position: absolute;
			left:8em;
			top:3em;
			width:calc(100% - 16em - 0em);
			min-height:32px;
			max-height:calc(100% - 3em - 0em);
			overflow:hidden;
		}
		section#content span{
			display:inline-block;
			height:calc(100% - 3em);
			width:calc(100% - 3em);
			margin:1.5em;
		}
		section#content nav#doc-navigation{
			position:absolute;
			top:0px;
			right:0px;
			width:32px;
			min-height:100%;
		}
		section#content div.dummy {
			width:100%;
			height:100%;
		}


		section#content div.head{
			width: calc(100%);
		    height: calc(200px);
		    float: left;
		}
		section#content div.head h1,
		section#content div.head h5,
		section#content div.head nav{
			padding-left: 24px;
			width:calc(100% - 200px - 24px);
			float:left;
		}
		section#content div.head nav{
			padding-top:32px;
		}
		section#content div.head h1{
			padding-top: 24px;
		}
		section#content div.head span{
			margin:0px;
		}
		section#content div.rate {
			min-height: calc(100% - 200px);
			float:left;
		}



		nav#doc-navigation a.fa-chevron-circle-down{
			position:absolute;
			bottom:0px;
		}


		header a.fa-question-circle,
		header a.fa-question-circle-o{
			position: absolute;
			right:0px;
		}
		header a.fa-cog,
		header nav#cfg-navigation,
		header nav#doc-controls{
			position: absolute;
			right:0px;
			bottom:0px;
		}
		header nav#cfg-navigation,
		header nav#doc-controls{
			bottom:32px;
			width:32px;
		}
		header nav#doc-controls{
			right:32px;
		}



		footer form{
			float:left;
		}
		footer form img{
			width:150px;
			height:150px;
		    position:relative;
		    left:calc(50% - 75px);
		    top:calc(50% - 75px);
		}
		footer form a{
			width:calc(100%);
			height:32px;
			line-height:32px;
		}
	</style>
</head>
<body>
	<header id="zone">
		<a href="#" class="fa fa-question-circle-o fa-1-5x" call="help-toggle"></a>
		<a href="#" class="fa fa-cog fa-1-5x" call="cfg-toggle"></a>
		<nav id="cfg-navigation" class="hide">
			<a href="#" class="fa fa-pause" call="animation-pause"></a>
			<a href="#" class="fa"></a>
			<a href="#" class="fa fa-eyedropper fa-1-5x" call="animation-colors"></a>
			<a href="#" class="fa fa-eye-slash fa-1-5x" call="design-toggle"></a>
			<a href="#" class="fa fa-tachometer fa-1-5x" call="animation-velocity"></a>
			<a href="#" class="fa fa-wrench fa-1-5x" call="animation-refresh"></a>
		</nav>
		<nav id="doc-controls" class="hide">
			<a href="#" class="fa fa-plus fa-1-5x" call="background-darker"></a>
			<a href="#" class="fa fa-minus fa-1-5x" call="background-lighter"></a>
			<a href="#" class="fa"></a>
			<a href="#" class="fa fa-plus fa-1-5x" call="text-increase"></a>
			<a href="#" class="fa fa-minus fa-1-5x" call="text-decrease"></a>
		</nav>
		<section id="content">
			<nav id="doc-navigation">
				<a href="#" class="fa fa-chevron-circle-up hide" call="scroll-up"></a>
				<a href="#" class="fa fa-chevron-circle-down" call="scroll-down"></a>
			</nav>
			<div class="dummy"></div>
			<footer>
				<form class="c-1 r-1-4"></form>
				<form class="c-1 r-2-4">
					<img src="images/favicon.coyote.poly_white.b.png">
				</form>
				<form class="r-1-4">
					<a href="#" call="call-mvp-test">Impressum</a>
					<a href="#">License</a>
					<a href="#">Impressum</a>
				</form>	
			</footer>
		</section>
		<user>
			<card class="hide">
				<a href="#" class="fa fa-user" call="token-toggle"></a>	
				<id>user@mail.de</id>
			</card>
			<form class="hide" call="login-validate">
				<input type="text" id="mail" name="mail" placeholder="mail" value="">
				<input type="text" id="pass" name="pass" placeholder="pass" value="">				
			</form>
			<a href="#" class="fa fa-hashtag" call="login-show"></a>
		</user>
		<popup class="hide">
			<span id="message"></span>
		</popup>
	</header>
</body>
</html>